<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MOTO-GACHA: RAMEN JACKPOT</title>
    <link href="https://fonts.googleapis.com/css2?family=DotGothic16&family=Fjalla+One&family=Mochiy+Pop+One&display=swap" rel="stylesheet">
    
    <style>
        /* --- CSS („Éá„Ç∂„Ç§„É≥) --- */
        :root {
            --pop-yellow: #ffde00;
            --pop-pink: #ff00cc;
            --pop-cyan: #00ffff;
            --dark-bg: #1a1025;
            --machine-bg: #2d2d2d;
        }

        body {
            background-color: var(--dark-bg);
            color: #fff;
            font-family: 'Mochiy Pop One', sans-serif;
            margin: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            overscroll-behavior: none;
            background-image: repeating-conic-gradient(from 0deg, #1a1025 0deg 20deg, #251835 20deg 40deg);
        }

        .gacha-machine {
            width: 95%;
            max-width: 450px;
            background: var(--machine-bg);
            border: 6px solid var(--pop-yellow);
            border-radius: 20px;
            padding: 15px;
            box-shadow: 0 0 50px rgba(255, 222, 0, 0.3);
            position: relative;
            box-sizing: border-box;
        }

        .lights-top { display: flex; justify-content: space-between; margin-bottom: 10px; }
        .light {
            width: 12px; height: 12px;
            background: #555;
            border-radius: 50%;
            animation: flash 1s infinite alternate;
        }
        .light:nth-child(1) { background: #f00; animation-delay: 0s; }
        .light:nth-child(2) { background: #ff0; animation-delay: 0.2s; }
        .light:nth-child(3) { background: #0f0; animation-delay: 0.4s; }
        .light:nth-child(4) { background: #00f; animation-delay: 0.6s; }
        @keyframes flash { from { opacity: 0.3; } to { opacity: 1; box-shadow: 0 0 10px #fff; } }

        header { text-align: center; margin-bottom: 15px; }
        .game-title {
            margin: 0; font-size: 1.5rem; color: var(--pop-yellow);
            text-shadow: 3px 3px 0 #000;
        }
        .sub-title { font-size: 0.6rem; color: #aaa; font-family: 'DotGothic16', sans-serif; letter-spacing: 2px; }

        .display-window {
            background: #000;
            height: 320px;
            border-radius: 10px;
            border: 4px solid #444;
            position: relative;
            overflow: hidden;
            display: flex;
            justify-content: center;
            align-items: center;
            margin-bottom: 20px;
            box-shadow: inset 0 0 20px rgba(0,0,0,0.8);
        }

        .reel-text {
            font-size: 2rem; color: #fff; font-family: 'DotGothic16', sans-serif; text-align: center; white-space: nowrap;
        }

        /* ÁµêÊûú„Ç™„Éº„Éê„Éº„É¨„Ç§ */
        .result-overlay {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            background: linear-gradient(135deg, #1a1025, #4a1035);
            display: none;
            flex-direction: column;
            align-items: center;
            justify-content: flex-start;
            padding: 20px;
            box-sizing: border-box;
            overflow-y: auto; 
            z-index: 100;
        }
        /* „Çπ„ÇØ„É≠„Éº„É´„Éê„Éº */
        .result-overlay::-webkit-scrollbar { width: 6px; }
        .result-overlay::-webkit-scrollbar-thumb { background: var(--pop-yellow); border-radius: 3px; }

        .result-overlay.show {
            display: flex;
            animation: popIn 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        @keyframes popIn { from { transform: scale(0.5); opacity: 0; } to { transform: scale(1); opacity: 1; } }

        .rank-badge {
            flex-shrink: 0;
            background: var(--pop-yellow); color: #000; font-size: 1.2rem; font-weight: bold;
            padding: 3px 15px; transform: rotate(-5deg); box-shadow: 4px 4px 0 var(--pop-pink);
            margin-bottom: 10px; border: 2px solid #000;
        }

        .shop-name-big {
            font-size: clamp(1.2rem, 5vw, 1.8rem);
            color: #fff; text-align: center; line-height: 1.3; margin-bottom: 10px;
            text-shadow: 0 0 10px var(--pop-cyan); word-break: break-all;
        }

        .info-pill-container { 
            display: flex; gap: 8px; margin-bottom: 10px; flex-wrap: wrap; justify-content: center; flex-shrink: 0;
        }
        .info-pill {
            background: #333; color: #fff; padding: 4px 10px; border-radius: 15px; font-size: 0.7rem; font-family: 'DotGothic16'; white-space: nowrap;
        }
        .info-pill.time { background: var(--pop-pink); color: #fff; }

        .shop-comment {
            font-size: 0.8rem; color: #ddd; text-align: center; margin-bottom: 15px;
            background: rgba(255,255,255,0.1); padding: 10px; border-radius: 8px; width: 100%;
            line-height: 1.5; box-sizing: border-box;
        }

        .map-btn {
            flex-shrink: 0;
            background: var(--pop-cyan); color: #000; text-decoration: none; font-weight: bold;
            padding: 12px 0; border-radius: 30px; border: 3px solid #000; box-shadow: 0 4px 0 #009999;
            transition: 0.1s; width: 90%; text-align: center; display: block; margin-bottom: 10px; font-size: 1rem;
        }
        .map-btn:active { transform: translateY(4px); box-shadow: none; }

        .close-btn {
            flex-shrink: 0;
            background: transparent; border: none; color: #aaa; margin-bottom: 10px; cursor: pointer;
            text-decoration: underline; font-size: 0.8rem; padding: 10px;
        }

        .control-deck { background: #222; padding: 10px; border-radius: 10px; }
        .settings-row { display: flex; gap: 10px; margin-bottom: 10px; }
        .setting-box { flex: 1; background: #111; padding: 8px; border-radius: 8px; border: 1px solid #333; }
        .setting-box label { display: block; font-size: 0.6rem; color: #888; margin-bottom: 4px; text-align: center; }

        .toggle-switch { display: flex; background: #333; border-radius: 5px; padding: 2px; }
        .toggle-switch input { display: none; }
        .toggle-switch label {
            flex: 1; text-align: center; padding: 6px 0; font-size: 0.7rem; cursor: pointer; color: #888; border-radius: 4px; transition: 0.2s; white-space: nowrap;
        }
        .toggle-switch input:checked + label { background: var(--pop-yellow); color: #000; font-weight: bold; }
        .dist-switch input:checked + label { background: var(--pop-pink); color: #fff; }

        .spin-button {
            width: 100%;
            background: linear-gradient(to bottom, #ff5e00, #ff0000);
            border: none; border-radius: 15px; padding: 12px; cursor: pointer;
            box-shadow: 0 6px 0 #990000, 0 10px 20px rgba(255,0,0,0.4);
            position: relative; overflow: hidden;
        }
        .spin-button:active { transform: translateY(6px); box-shadow: none; }
        .spin-button::after {
            content: ""; position: absolute; top: 0; left: -100%; width: 50%; height: 100%;
            background: linear-gradient(skewX(-20deg), transparent, rgba(255,255,255,0.4), transparent);
            animation: shine 3s infinite;
        }
        @keyframes shine { 0% { left: -100%; } 20% { left: 200%; } 100% { left: 200%; } }

        .spin-text { display: block; font-size: 1.8rem; color: #fff; font-family: 'Fjalla One', sans-serif; text-shadow: 2px 2px 0 #000; }
        .spin-sub { display: block; font-size: 0.7rem; color: #ffcccc; font-weight: bold; }
        .shake { animation: shake 0.5s cubic-bezier(.36,.07,.19,.97) both; }
        @keyframes shake { 10%, 90% { transform: translate3d(-1px, 0, 0); } 20%, 80% { transform: translate3d(2px, 0, 0); } 30%, 50%, 70% { transform: translate3d(-4px, 0, 0); } 40%, 60% { transform: translate3d(4px, 0, 0); } }
    </style>
</head>
<body>

<div class="gacha-machine">
    <div class="lights-top"><div class="light"></div><div class="light"></div><div class="light"></div><div class="light"></div></div>

    <header>
        <h1 class="game-title">üçú „É©„Éº„É°„É≥„Ç¨„ÉÅ„É£ üèçÔ∏è</h1>
        <div class="sub-title">TODAY'S DESTINATION</div>
    </header>

    <div class="display-window">
        <div class="reel-container">
            <div id="reel-text" class="reel-text">PRESS START</div>
        </div>
        
        <div id="result-overlay" class="result-overlay">
            <div class="rank-badge" id="res-rank">SSR</div>
            <div class="shop-name-big" id="res-name">Â∫óÂêç</div>
            
            <div class="info-pill-container">
                <span class="info-pill" id="res-area">„Ç®„É™„Ç¢</span>
                <span class="info-pill time" id="res-time">ÊôÇÈñì</span>
            </div>
            
            <p class="shop-comment" id="res-desc">„Ç≥„É°„É≥„Éà</p>
            
            <a id="btn-open-map" href="#" target="_blank" class="map-btn">
                üó∫Ô∏è Âú∞Âõ≥„Ç¢„Éó„É™„ÅßGO! 
            </a>
            
            <button class="close-btn" onclick="resetGacha()">„ÇÇ„ÅÜ‰∏ÄÂõû„Åæ„Çè„Åô</button>
        </div>
    </div>

    <div class="control-deck">
        <div class="settings-row">
            <div class="setting-box">
                <label>ÁèæÂú®Âú∞</label>
                <div class="toggle-switch">
                    <input type="radio" name="loc" id="gps" checked onclick="setLoc('GPS')">
                    <label for="gps">GPS</label>
                    <input type="radio" name="loc" id="manual" onclick="setLoc('MANUAL')">
                    <label for="manual">Êù±‰∫¨</label>
                </div>
            </div>
            <div class="setting-box">
                <label>Ë∑ùÈõ¢</label>
                <div class="toggle-switch dist-switch">
                    <input type="radio" name="rng" id="short" checked onclick="setRng('SHORT')">
                    <label for="short">ËøëÂ†¥</label>
                    <input type="radio" name="rng" id="long" onclick="setRng('LONG')">
                    <label for="long">ÈÅ†Âá∫</label>
                </div>
            </div>
        </div>

        <button class="spin-button" onclick="spinGacha()">
            <span class="spin-text">SPIN!</span>
            <span class="spin-sub">ÈÅãÂëΩ„ÇíÂõû„Åõ</span>
        </button>
    </div>
</div>

<script>
    /* --- DATA („Éá„Éº„Çø„Éô„Éº„Çπ) --- */
    const ramenSpots = [
        // TOKYO
        { id: "t01", name: "„Éõ„Éº„ÉóËªí ÂçÉÈßÑ„É∂Ë∞∑", lat: 35.6791, lng: 139.7136, region: "TOKYO", parking: "Ë∑ØÈßêÂ§ö„ÇÅ", tags: ["CITY"], desc: "„Äê24hÂñ∂Ê•≠„ÄëÈªÑËâ≤„ÅÑÁúãÊùø„ÅØÊ∑±Â§ú„ÅÆÁÅØÂè∞„ÄÇÂõΩÁ´ãÁ´∂ÊäÄÂ†¥„ÇíÊúõ„ÇÄ„Éä„Ç§„Éà„É©„É≥„ÅÆËÅñÂú∞„ÄÇ" },
        { id: "t02", name: "„É©„Éº„É°„É≥‰∫åÈÉé ‰∏âÁî∞Êú¨Â∫ó", lat: 35.6481, lng: 139.7416, region: "TOKYO", parking: "ËøëÈö£CP", tags: ["LEGEND"], desc: "„ÄêÁ∑èÊú¨Â±±„ÄëÊù±‰∫¨„Çø„ÉØ„Éº„ÇíË¶ã„Å™„Åå„ÇâËµ∞„ÇãR1„É´„Éº„Éà„ÄÇÂÖ®„Å¶„ÅÆ‰∫åÈÉé„ÅÆÂéüÁÇπ„ÄÇ" },
        { id: "t03", name: "„ÅÆ„Çì„Åç„ÇÑ (Â••Â§öÊë©)", lat: 35.7905, lng: 139.0505, region: "TOKYO", parking: "Â∫óÂâçÂ∫ÉÂ†¥", tags: ["WINDING"], desc: "„ÄêÂ≥†È£Ø„ÄëÂ••Â§öÊë©Âë®ÈÅäÈÅìË∑Ø„ÇíÊîª„ÇÅ„ÅüÂæå„ÅÆ‰ºëÊÜ©„Éù„Ç§„É≥„Éà„ÄÇÊâãÊâì„Å°È∫∫„Å®Êπñ„ÅÆÁµ∂ÊôØ„ÄÇ" },
        { id: "t04", name: "„Çâ„Éº„ÇÅ„ÇìÂºÅÊÖ∂ Â†ÄÂàáÂ∫ó", lat: 35.7483, lng: 139.8252, region: "TOKYO", parking: "1FÈßêËªäÂ†¥", tags: ["CITY"], desc: "„ÄêËÉåËÑÇ„ÄëËçíÂ∑ù„ÉªÁ∂æÁÄ¨Â∑ùÊ≤ø„ÅÑ„ÅÆÂø´Ëµ∞Ë∑Ø„ÄÇ‰∏ãÁî∫„É©„Ç§„ÉÄ„Éº„ÅÆ„Ç¨„ÇΩ„É™„É≥„Çπ„Çø„É≥„Éâ„ÄÇ" },
        { id: "t05", name: "„É©„Éº„É°„É≥„Ç∑„Éß„ÉÉ„Éó Ê§ø (Êñ∞Â∞èÈáë‰∫ï)", lat: 35.6925, lng: 139.5032, region: "TOKYO", parking: "P„ÅÇ„Çä", tags: ["GARLIC"], desc: "„ÄêË°óÈÅìÊ≤ø„ÅÑ„ÄëÂ§öÊë©„É©„Ç§„ÉÄ„Éº„Å´ÊÑõ„Åï„Çå„Çã„É©„Éº„Ç∑„Éß„ÄÇ„Éã„É≥„Éã„ÇØ„ÇíÂÖ•„Çå„Å¶„Éä„Ç§„Éà„É©„É≥„Å∏„ÄÇ" },
        // CHIBA
        { id: "c01", name: "Ê¢Ö‰πÉÂÆ∂ (Á´πÂ≤°Âºè)", lat: 35.2158, lng: 139.8285, region: "CHIBA", parking: "Ë∑ØËÇ©/Á©∫Âú∞", tags: ["COASTAL"], desc: "„ÄêÊµ∑Ê≤ø„ÅÑ„ÄëR127ÂÜÖÊàø„Å™„Åé„Åï„É©„Ç§„É≥„ÄÇ„ÉÅ„É£„Éº„Ç∑„É•„Éº„ÅÆÁÖÆÊ±ÅÂâ≤„Çπ„Éº„Éó„ÅåÊüì„Åø„Çã„ÄÇ" },
        { id: "c02", name: "„Ç¢„É™„É©„É≥„É©„Éº„É°„É≥ ÂÖ´Âπ≥", lat: 35.4055, lng: 140.1764, region: "CHIBA", parking: "Â∞ÇÁî®P", tags: ["WINDING"], desc: "„ÄêÁßòÂ¢É„ÄëGoogle„Éû„ÉÉ„ÉóÂøÖÈ†à„ÅÆÂ≥†Ë∂ä„Åà„É´„Éº„Éà„ÄÇÁéâ„Å≠„Åé„Å®„Éã„É≥„Éã„ÇØ„ÅÆ„Çπ„Çø„Éü„ÉäÁ≥ª„ÄÇ" },
        { id: "c03", name: "‰∏ÄÂ±±„ÅÑ„Åë„Åô (Êµ∑ÈÆÆ)", lat: 35.6985, lng: 140.8544, region: "CHIBA", parking: "Â§ßÂûãP", tags: ["COASTAL"], desc: "„ÄêÂ§™Âπ≥Ê¥ã„Äë‰πùÂçÅ‰πùÈáå„Éì„Éº„ÉÅ„É©„Ç§„É≥„ÅÆÂåóÁ´Ø„ÄÇ‰ºäÂã¢Êµ∑ËÄÅ„É©„Éº„É°„É≥„ÇíÁõÆÊåá„Åô„É≠„É≥„Ç∞„É©„É≥„ÄÇ" },
        { id: "c04", name: "„Å™„Çä„Åü„Åë Ê¥•Áî∞Ê≤ºÂ∫ó", lat: 35.6917, lng: 140.0206, region: "CHIBA", parking: "ËøëÈö£CP", tags: ["CITY"], desc: "„ÄêËÉåËÑÇ„ÄëÂçÉËëâ„É©„Ç§„ÉÄ„Éº„ÅÆ„ÇΩ„Ç¶„É´„Éï„Éº„Éâ„ÄÇR14/R296„Åß„ÅÆ„Éä„Ç§„Éà„É©„É≥Âêë„Åë„ÄÇ" },
        // SAITAMA
        { id: "s01", name: "Áß©Áà∂ ÁèçÈÅî„Åù„Å∞", lat: 35.9972, lng: 139.0845, region: "SAITAMA", parking: "Â∫óÂâçP", tags: ["WINDING"], desc: "„ÄêR299„ÄëÊ≠£‰∏∏„Éà„É≥„Éç„É´„ÇíÊäú„Åë„ÅüÂÖà„ÅÆ„Ç¥„Éº„É´Âú∞ÁÇπ„ÄÇ„Éç„ÇÆ„Åü„Å£„Å∑„Çä„ÅÆ‰∏ÄÊùØ„ÄÇ" },
        { id: "s02", name: "Â§ßÊªùÈ£üÂ†Ç („Éê„Ç§„ÇØÂºÅÂΩì)", lat: 35.9525, lng: 138.9328, region: "SAITAMA", parking: "„Éê„Ç§„ÇØP", tags: ["MECCA"], desc: "„ÄêËÅñÂú∞„Äë„Çø„É≥„ÇØÂûãÂÆπÂô®„ÅÆÂºÅÂΩì„ÄÇÂΩ©Áî≤ÊñêË°óÈÅì„ÅÆ„ÉØ„Ç§„É≥„Éá„Ç£„É≥„Ç∞„ÇíÊ•Ω„Åó„ÇÅ„Çã„ÄÇ" },
        { id: "s04", name: "‰∏≠ËèØ„Åù„Å∞ Âõõ„Å§Ëëâ", lat: 35.9752, lng: 139.4755, region: "SAITAMA", parking: "Ë∂ÖÂ§ßÂûãP", tags: ["RURAL"], desc: "„ÄêÂ≠§È´ò„ÅÆÂêçÂ∫ó„ÄëËªä„Åã„Éê„Ç§„ÇØ„Åß„Åó„ÅãË°å„Åë„Å™„ÅÑÁ´ãÂú∞„Å†„ÅåÊó•Êú¨„Éà„ÉÉ„Éó„ÇØ„É©„Çπ„ÅÆ‰∫∫Ê∞ó„ÄÇ" },
        // KANAGAWA
        { id: "k01", name: "È£ØÁî∞ÂïÜÂ∫ó", lat: 35.1436, lng: 139.1065, region: "KANAGAWA", parking: "‰∫àÁ¥ÑÂà∂/P", tags: ["COASTAL"], desc: "„ÄêË•øÊπòBP„ÄëÊµ∑Ê≤ø„ÅÑ„ÅÆÂø´Ëµ∞Ë∑Ø„ÇíÊäú„Åë„ÅüÂÖà„Å´„ÅÇ„ÇãËá≥È´ò„ÅÆÂ∫ó„ÄÇÂÆåÂÖ®‰∫àÁ¥ÑÂà∂„ÄÇ" },
        { id: "k02", name: "ÂêâÊùëÂÆ∂ (Á∑èÊú¨Â±±)", lat: 35.4655, lng: 139.6163, region: "KANAGAWA", parking: "ËøëÈö£CP", tags: ["LEGEND"], desc: "„ÄêÊ®™Êµú„ÄëÁ¨¨‰∏â‰∫¨Êµú„ÇÑÈ¶ñÈÉΩÈ´òÊ®™ÁæΩÁ∑ö„Åã„Çâ„ÅÆ„Ç¢„ÇØ„Çª„Çπ„ÄÇÂÆ∂Á≥ª„ÅÆÂéüÁÇπ„ÄÇ" },
        { id: "k04", name: "ZUND-BAR", lat: 35.4452, lng: 139.2905, region: "KANAGAWA", parking: "Â∞ÇÁî®P", tags: ["WINDING"], desc: "„Äê‰∏πÊ≤¢„ÄëAFURI„ÅÆÁ∑èÊú¨Â∫ó„ÄÇÂ±±Â••„Å´„ÅÇ„Çã„ÅäÊ¥íËêΩ„Å™Â∫ó„ÄÇÂÆÆ„É∂ÁÄ¨„ÉÄ„É†„Å∏Êäú„Åë„Çã„É´„Éº„Éà„ÄÇ" },
        // IBARAKI
        { id: "ib01", name: "„É©„Éº„Ç∑„Éß Áâõ‰πÖÁµêÊùüÂ∫ó", lat: 35.9660, lng: 140.1655, region: "IBARAKI", parking: "Á†ÇÂà©PÂ§ß", tags: ["LEGEND"], desc: "„ÄêÊó•Êú¨‰∏Ä„ÄëÂÖ®ÂõΩ„ÅÆ„É©„Éº„É°„É≥„Ç∑„Éß„ÉÉ„Éó„ÅÆ‰∏≠„ÅßÊúÄÈ´òË©ï‰æ°„ÇíÂæó„Çã‰ºùË™¨Â∫ó„ÄÇ" },
        // GUNMA
        { id: "gm03", name: "Ê∞∏‰∫ïÈ£üÂ†Ç („ÇÇ„Å§ÁÖÆ)", lat: 36.5458, lng: 139.0225, region: "GUNMA", parking: "Â§ßÂûãP", tags: ["MECCA"], desc: "„ÄêËÅñÂú∞„Äë„É©„Éº„É°„É≥„Åß„ÅØ„Å™„ÅÑ„ÅåÁæ§È¶¨„ÉÑ„Éº„É™„É≥„Ç∞„Å®„ÅÑ„Åà„Å∞„Ç≥„Ç≥„ÄÇR17‰∏âÂõΩÂ≥†„ÅÆÊâãÂâç„ÄÇ" },
    ];

    /* --- APP LOGIC („É≠„Ç∏„ÉÉ„ÇØ) --- */
    let systemState = {
        locationMode: 'GPS', 
        rangeMode: 'SHORT',
        userPos: null,
        isSpinning: false
    };

    const BASE_POS = { lat: 35.6812, lng: 139.7671 };

    function setLoc(mode) {
        systemState.locationMode = mode;
        if(mode === 'GPS') {
            navigator.geolocation.getCurrentPosition(
                (pos) => { systemState.userPos = { lat: pos.coords.latitude, lng: pos.coords.longitude }; },
                (err) => { alert("GPSÂ§±ÊïóÔºÅ„Éû„Éã„É•„Ç¢„É´„É¢„Éº„Éâ„Å´„Åó„Åæ„Åô"); document.getElementById('manual').checked = true; setLoc('MANUAL'); }
            );
        }
    }

    function setRng(mode) { systemState.rangeMode = mode; }

    function getDistance(lat1, lng1, lat2, lng2) {
        const R = 6371; 
        const dLat = (lat2 - lat1) * Math.PI / 180;
        const dLng = (lng2 - lng1) * Math.PI / 180;
        const a = Math.sin(dLat/2) * Math.sin(dLat/2) +
                  Math.cos(lat1 * Math.PI / 180) * Math.cos(lat2 * Math.PI / 180) *
                  Math.sin(dLng/2) * Math.sin(dLng/2);
        return R * 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
    }

    function spinGacha() {
        if(systemState.isSpinning) return;

        let startPos = systemState.userPos;
        if (systemState.locationMode === 'MANUAL') startPos = BASE_POS;
        else if (!startPos) {
            alert("GPSÊé¢Á¥¢‰∏≠...„ÇÇ„ÅÜ‰∏ÄÂ∫¶Êäº„Åó„Å¶„Å≠");
            setLoc('GPS');
            return;
        }

        const candidates = ramenSpots.map(shop => {
            return { ...shop, dist: getDistance(startPos.lat, startPos.lng, shop.lat, shop.lng) };
        }).filter(shop => {
            if (systemState.rangeMode === 'SHORT') return shop.dist <= 35;
            return shop.dist > 35;
        });

        if (candidates.length === 0) {
            alert("„Åì„ÅÆÁØÑÂõ≤„Å´„ÅäÂ∫ó„Åå„Å™„ÅÑÔºÅË®≠ÂÆö„ÇíÂ§â„Åà„Å¶„Åø„Å¶ÔºÅ");
            return;
        }

        systemState.isSpinning = true;
        document.getElementById('result-overlay').classList.remove('show');
        
        const reel = document.getElementById('reel-text');
        const display = document.querySelector('.display-window');
        display.classList.add('shake');
        
        let count = 0;
        const maxCount = 20; 
        const interval = setInterval(() => {
            const randomName = ramenSpots[Math.floor(Math.random() * ramenSpots.length)].name;
            reel.innerText = randomName;
            reel.style.color = count % 2 === 0 ? '#ffde00' : '#fff';
            
            count++;
            if (count > maxCount) {
                clearInterval(interval);
                display.classList.remove('shake');
                const winner = candidates[Math.floor(Math.random() * candidates.length)];
                showResult(winner);
                systemState.isSpinning = false;
            }
        }, 100);
    }

    function showResult(shop) {
        const overlay = document.getElementById('result-overlay');
        
        document.getElementById('res-name').innerText = shop.name;
        document.getElementById('res-area').innerText = shop.region;
        document.getElementById('res-desc').innerText = shop.desc;
        
        const timeEst = Math.round(shop.dist / 30 * 60);
        const timeText = timeEst > 60 ? Math.floor(timeEst/60) + "ÊôÇÈñì" + (timeEst%60) + "ÂàÜ" : timeEst + "ÂàÜ";
        document.getElementById('res-time').innerText = "ÁâáÈÅì " + timeText;

        const rank = document.getElementById('res-rank');
        if(shop.dist > 100) { rank.innerText = "UR"; rank.style.background = "linear-gradient(45deg, #ffd700, #fff)"; }
        else if(shop.dist > 50) { rank.innerText = "SSR"; rank.style.background = "#ff00cc"; }
        else { rank.innerText = "SR"; rank.style.background = "#00ffff"; }

        const mapBtn = document.getElementById('btn-open-map');
        mapBtn.href = `https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(shop.name + " " + shop.region)}`;

        overlay.classList.add('show');
    }

    function resetGacha() {
        document.getElementById('result-overlay').classList.remove('show');
        document.getElementById('reel-text').innerText = "PRESS START";
    }

    window.onload = function() {
        setLoc('GPS');
    };
</script>

</body>
</html>
